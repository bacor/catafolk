{
    "dataset_id": "sagrillo-lorraine",
    "sources": {
        "file": {
            "type": "file",
            "file_pattern": "data/*.krn",
            "file_options": {
                "encoding": "ISO-8859-1"
            }
        }
    },
    "transformations": [
        ["rename", "file.cf_checksum", "checksum"],
        ["rename", "file.cf_path", "path"],
        ["rename", "file.cf_format", "format"],
        ["constant", "dataset_id", "sagrillo-lorraine"],
        ["constant", "encoder", "Damien Sagrillo"],
        ["constant", "has_music", true],
        ["constant", "has_lyrics", false],

        ["rename", "file.reg", "location"],
        ["rename", "file.fkt", "genre"],

        [
            "format", "path", "preview_url", 
            {"pattern": "http://verovio.humdrum.org/?file=sagrillo/lorraine/{}"}
        ],
        [
            "format", "path", "url", 
            {"pattern": "https://kern.humdrum.org/cgi-bin/ksdata?file={}&l=users/sagrillo/lorraine&format=kern"}
        ],
        {
            "operation": "map_values",
            "inputs": ["file.trd"],
            "outputs": ["source_key"],
            "params": { "mapping": {
                "PINCK, Louis: Verklingende Weisen, Bd 1, Metz 1928": "pinck1926verklingende1",
                "PINCK, Louis: Verklingende Weisen, Bd 2, Metz 1928": "pinck1928verklingende2",
                "PINCK, Louis: Verklingende Weisen, Bd3, Metz 1933": "pinck1933verklingende3",
                "PINCK, Louis: Verklingende Weisen Bd 4, Kassel 1939": "pinck1939verklingende4"
            }}
        },
        {
            "operations": ["extract_groups", "lowercase"],
            "inputs": ["file.mod"],
            "outputs": ["modality_de", "ambitus"],
            "params": [{
                "pattern": "([^\\]\\?]+) ?\\??\\] +AMBITUS\\[(\\w+)",
                "groups": [1,2]
            }, {}]   
        },
        {
            "operation": "extract_groups",
            "inputs": ["file.key"],
            "outputs": ["key", "meter_de"],
            "params": {
                "pattern": "(\\w+) +(\\d+) +([\\w\\#]+) ([ \\w\/]+) ?\\] +ZZ\\[(\\d+)",
                "groups": [3,4]
            }
        },
        {
            "operation": "map_values",
            "inputs": ["meter_de"],
            "outputs": ["meter"],
            "params": {
                "mapping": { "FREI": "free" },
                "return_missing": true
            }
        },
        {
            "operation": "extract_groups",
            "inputs": ["file.OTL"],
            "outputs": ["title_html", "source_song_num", "source_song_num", "source_page_num"],
            "params": {
                "pattern": "^([^\\(,]+(, (?!S.)(?!Nr)[^\\(,]+)*)((,? ?\\((.+)\\))|(, Nr\\. (\\d+)))?(,? S. ?(.+))?",
                "groups": [1, 5, 7, 9]
            }
        },
        ["unescape_html", "title_html", "title"],
        {
            "operation": "map_values",
            "inputs": ["modality_de"],
            "outputs": ["modality"],
            "params": {
                "mapping": {
                    "dreitonskala $": "tritonic",
                    "viertonskala$": "tetratonic",
                    "pentatonik ?$": "pentatonic",
                    "pentatonik dur$": "pentatonic major",
                    "pentatonik moll $": "pentatonic minor",
                    "pentatonik halbtonl\\. .+": "pentatonic (halftone)",
                    "sechstonskala ?$": "hexatonic",
                    "sechstonskala dur ": "hexatonic minor",
                    "sechstonskala moll": "hexatonic minor",
                    "heptatonik $" : "heptatonic",
                    "heptatonik moll": "heptatonic minor",
                    "heptatonic major": "heptatonic major",
                    "heptatonik dur": "heptatonic major",
                    "heptatonic minor": "heptatonic minor",
                    "heptatonik +ionisch": "heptatonic ionian",
                    "heptatonik dorisch": "heptatonic dorian",
                    "heptatonik phrygisch": "heptatonic phrygian",
                    "heptatonik lydisch": "heptatonic lydian",
                    "heptatonik mixolydisch": "heptatonic mixolydian",
                    "heptatonik aeolisch": "heptatonic aeolean",
                    "achttonskala $": "octatonic",
                    "achttonskala melodisch moll ohne 7": "octatonic w/o 7",
                    "achttonskala melodisch moll ohne 6": "octatonic minor w/o 6",
                    "achttonskala melodisch moll ohne 6b": "octatonic minor w/o 6b",
                    "achttonskala dur": "octatonic major",
                    "neuntonskala ?$": "enneatonic",
                    "neuntonskala dur ?": "enneatonic major",
                    "neuntonskala moll ?": "enneatonic minor",
                    "zehntonskala $": "decatonic"
                }
            }
        }
    ],
    "corrections": {
        "p0566": {
            "title": "Der Fisch(?) Concelebrant",
            "source_song_num": "4-5",
            "source_page_num": "7"
        },
        "p1032": {
            "title": "Ach, Schatz, jetzt mu&szlig; ich wandern",
            "source_song_num": "3-59",
            "source_page_num": "170"
        },
        "p0573": {
            "source_song_num": "4-12"
        },
        "p0574": {
            "title": "Ich wine wei&szlig;e Spinnerin"
        },
        "p0575": {
            "source_song_num": "4-14",
            "source_page_num": "19"
        },
        "p0580|p0577":{
            "source_key": "pinck1939verklingende4"
        },
        "p0588": {
            "title": "Runckelstube",
            "source_song_num": "4-27",
            "source_page_num": "39"
        },
        "p0810": {
            "title": "Ich ging einmal spazieren",
            "source_page_num": "113"
        },
        "p0965": {
            "title": "Spinn, Spinn",
            "source_song_num": "2-94",
            "source_page_num": "275"
        }
    }
}