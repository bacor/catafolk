{
    "dataset_id": "densmore-pueblo",
    "sources": {
        "file": {
            "type": "file",
            "file_pattern": "data/*.krn",
            "id_transformations": [
                {
                    "operation": "extract_groups",
                    "inputs": ["OTL"],
                    "outputs": ["source_song_num"],
                    "params": {
                        "pattern": "No_(\\d+)",
                        "groups": [1]
                    }
                },
                ["format", "source_song_num", "new_id", {"pattern": "pueblo{:0>2}"}]
            ]
        },
        "additional_metadata": {
            "type": "csv",
            "path": "additional-metadata.csv",
            "id_field": "id"
        }
    },
    "transformations": [
        ["rename", "file.cf_checksum", "checksum"],
        ["rename", "file.cf_path", "path"],
        ["rename", "file.cf_format", "format"],
        ["constant", "dataset_id", "densmore-pueblo"],
        ["constant", "has_music", true],
        ["constant", "has_lyrics", false],
        ["constant", "source_key", "densmore1957pueblo"],
        ["constant", "encoder", "Daniel Shanahan and Eva Shanahan"],
        ["constant", "encoding_date", "<2014"],
        ["constant", "copyright", "Copyright 2014 Daniel and Eva Shanahan"],

        ["rename", "additional_metadata.song_num", "source_song_num"],
        ["rename", "additional_metadata.page_number", "source_page_num"],
        ["rename", "additional_metadata.catalogue_num", "catalogue_number"],
        ["rename", "additional_metadata.performer", "performer"],
        ["rename", "additional_metadata.collector", "collector"],
        ["rename", "additional_metadata.collection_date", "collection_date"],
        ["rename", "additional_metadata.culture", "culture"],
        ["rename", "additional_metadata.location", "location"],
        ["rename", "additional_metadata.latitude", "latitude"],
        ["rename", "additional_metadata.longitude", "longitude"],
        ["rename", "additional_metadata.genre", "genre"],

        {
            "operations": ["to_int", "add", "format"],
            "inputs": ["source_page_num"],
            "outputs": ["source_url"],
            "params": [
                {},
                {"value": 12},
                {"pattern": "https://babel.hathitrust.org/cgi/pt?id=mdp.39015024865878&view=1up&seq={}"}
            ]
        },
        [
            "format", "file.cf_name", "url", 
            {"pattern": "https://github.com/shanahdt/densmore/raw/master/Densmore/acoma/{}.krn"}
        ],
        {
            "operation": "extract_groups",
            "inputs": ["file.OTL"],
            "outputs": ["source_song_num", "title_underscore"],
            "params": {
                "pattern": "No_(\\d+)_([^\\.]+).krn",
                "groups": [1, 2]
            }
        },
        ["replace", "title_underscore", "title", {"old": "_", "new": " "}]
    ]
}