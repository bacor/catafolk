dataset_id: densmore-pueblo
title: Densmore Pueblo Music
dataset_url: https://github.com/shanahdt/densmore/tree/master/Densmore/acoma
authors: 
  - name: Frances Densmore
    role: author
  - name: Daniel Shanahan
    role: encoder
  - name: Eva Shanahan
    role: encoder
contributors:
  - name: Bas Cornelissen
    role: additional metadata
    url: https://bascornelissen.nl
tags: [symbolic]
formats: [kern] 
songs: 82
licence_abbr: unknown
description: >
  A collection of 82 folksongs from several Pueblo peoples: Acoma, Isleta, Cochiti and Zuni.
  The songs were mostly collected by Frances Densmore between 1928 and 1940 and published 
  in her 1957 *Pueblo Music*. Digital encoding by Daniel and Eva Shanahan.
issues:
  - title: Copyright?
    description: There is no copyright/license.
  - title: Ignored meta fields
    description: >
      The following fields are currently ignored: `LING_GROUP` (the language family, it seems)
      `LANG` (mostly value `'Tone'`, probably indicating it is a tone language). `REG` (we use
      the location information from `additional-metadata.csv`), and `SUPERFUNCTION` (the genre
      or `'tribename'`)
show_columns:
  - location

sources:
  - name: file
    type: file
    file_pattern: data/*.krn
    id_transformations:
    - operation: extract_groups
      inputs: [OTL]
      outputs: [source_song_num]
      params:
        pattern: No_(\d+)
        groups: [1]
    - [format, source_song_num, new_id, {pattern: "pueblo{:0>2}"}]
  - name: additional_metadata
    type: csv
    path: additional-metadata.csv
    id_field: id
    
transformations:

  # Default Catafolk fields
  - rename: [file.cf_checksum, checksum]
  - rename: [file.cf_path, path]
  - rename: [file.cf_format, format]

  # Some constants
  - constant: [dataset_id, densmore-pueblo]
  - constant: [has_music, true]
  - constant: [has_lyrics, false]
  - constant: [source_key, densmore1957pueblo]
  - constant: [encoder, Daniel Shanahan and Eva Shanahan]
  - constant: [encoding_date, "<2014"]
  - constant: [copyright, Copyright 2014 Daniel and Eva Shanahan]

  # Additional metadata
  - rename: [additional_metadata.song_num, source_song_num]
  - rename: [additional_metadata.page_number, source_page_num]
  - rename: [additional_metadata.catalogue_num, cataologue_number]
  - rename: [additional_metadata.performer, performer]
  - rename: [additional_metadata.collector, collector]
  - rename: [additional_metadata.collection_date, collection_date]
  - rename: [additional_metadata.culture, culture]
  - rename: [additional_metadata.location, location]
  - rename: [additional_metadata.latitude, latitude]
  - rename: [additional_metadata.longitude, longitude]
  - rename: [additional_metadata.genre, genre]
  
  # Preview links from Hathi Trust (page number + offset of 12 pages)
  - operations: [to_int, add, format]
    inputs: [source_page_num]
    outputs: [source_url]
    params:
      - {}
      - value: 12
      - pattern: https://babel.hathitrust.org/cgi/pt?id=mdp.39015024865878&view=1up&seq={}
  
  # Link to Kern file on GitHub
  - format: 
    - file.cf_name
    - url
    - pattern: https://github.com/shanahdt/densmore/raw/master/Densmore/acoma/{}.krn
  
  # Extract title and song number from the file title
  - operation: extract_groups
    inputs: [file.OTL]
    outputs: [source_song_num, title_underscore]
    params:
      pattern: No_(\d+)_([^\.]+).krn
    groups: [1, 2]
  
  # Remove underscores from title
  - replace:
    - title_underscore
    - title
    - { old: _, new: " "}
