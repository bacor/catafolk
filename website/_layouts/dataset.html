---
layout: default
---
{% capture github_dataset_url -%}
  https://github.com/{{ site.github }}/tree/master/website/_datasets/{{ page.dataset_id }}.md
{%- endcapture %}
{% capture github_index_url -%}
  https://github.com/{{ site.github }}/tree/master/website/_data/{{ page.dataset_id }}-index.csv
{%- endcapture %}

{% assign index_name = page.dataset_id | append: "-index" %}
{% assign index = site.data[index_name] %}
{% assign has_analysis = true %}
{% if page.analyzed == false or page.analyzed == blank %}
  {% assign has_analysis = false %}
{% endif %}

{% assign max_num_files = 500 %}

<main class="container mt-5">
  <div class="jumbotron row">
    <div>
      <h1 class="display-4">{{ page.title }}</h1>
      <div class="lead" style="max-width: 700px">
        {% if page.description %}
          {{ page.description | markdownify }}
        {% else %}
          <span class="text-muted">This dataset has no description yet...</span>
        {% endif %}
      </div>
      
      {% if page.tags %}
      <div class="mb-4">
        {% for tag in page.tags %}
        <span class="badge badge-pill badge-dark">{{ tag }}</span>
        {% endfor %}
      </div>
      {% endif %}

      <a href="{{ page.dataset_url }}" class="btn btn-dark mr-2">
        Go to dataset <span class="oi oi-external-link small ml-2" title="View the file" aria-hidden="true"></span>
      </a>
      {% if has_analysis %}
      <a href="{{ github_index_url }}" class="btn btn-outline-secondary">
        View full index
        <span class="oi oi-external-link small ml-2" title="View the file" aria-hidden="true"></span>
      </a>
      {% endif %}
    </div>
  </div>

  <div class="row mt-5">
    <div class="card-deck">
      {% assign props_name = page.dataset_id | append: "-properties" %}
      {% assign props = site.data[props_name] %}

      <div class="card">
        <div class="card-header">
          Properties
        </div>
        <div class="card-body">
          <dl class="row">            
            <dt class="col-lg-3">Authors</dt>
            <dd class="col-lg-9">
              {% if page.authors %}
                {% for author in page.authors %}
                  {% if author.url %}<a href="{{ author.url }}" target="_blank">{% endif %}
                  {{ author.name }} <em>({{ author.role}})</em>
                  {%- if forloop.index < forloop.length %}<br />{% endif %}
                  {% if author.url %}</a>{% endif %}
                {% endfor %}
              {% else %}
                <span class="text-muted">This information is missing...</span>
              {% endif %}
            </dd>

            {% if page.contributors %}
            <dt class="col-lg-3">Contributors</dt>
            <dd class="col-lg-9">
              {% for contributor in page.contributors %}
                {% if contributor.url %}<a href="{{ contributor.url }}" target="_blank">{% endif %}
                {{ contributor.name }}
                {%- if forloop.index < forloop.length %};{% endif %}
                {% if contributor.url %}</a>{% endif %}
              {% endfor %}
            </dd>
            {% endif %}

            <dt class="col-lg-3">Copyright</dt>
            <dd class="col-lg-9">
              {% if page.copyright == 'unknown' %}
                <span class="text-danger">Unknown</span>
              {% else if page.copyright %}
                {{ page.copyright }}</a>
              {% else %}
                <span class="text-muted">This information is missing...</span>
              {% endif %}
            </dd>

            <dt class="col-lg-3">License</dt>
            <dd class="col-lg-9">
              {% if page.licence_abbr == 'unknown' %}
                <span class="text-danger">Unknown</span>
              {% else if page.licence_abbr %}
                <a href="{{page.license_url }}" target="_blank">{{ page.licence_abbr }}</a>
              {% else %}
                <span class="text-muted">This information is missing...</span>
              {% endif %}
            </dd>
          </dl>
        </div>
        {% if page.description == blank or page.sources == blank %}
        <div class="card-footer text-muted small">
          Some info is missing... Please consider <a href="{{ github_dataset_url }}">contributing</a> on GitHub</a>.
        </div>
        {% endif %}
      </div>

      <div class="card">
        <div class="card-header">
          Technicalities
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="col-lg-3">Dataset ID</dt>
            <dd class="col-lg-9"><code class="text-muted">{{ props.dataset_id | default: page.dataset_id }}</code></dd>

            <dt class="col-lg-3">Version</dt>
            <dd class="col-lg-9">
              <code class="text-muted">
                {{ page.version | default: "unknown" }}
              </code>
            </dd>

            <dt class="col-lg-3">Checksum</dt>
            <dd class="col-lg-9">
              {% if props.checksum %}
                <code class="text-muted">{{ props.checksum }}</code></dd>
              {% else %}
                <span class="text-muted">The dataset has not yet been analyzed...</span>
              {% endif %}
              
            <dt class="col-lg-3">File format</dt>
            <dd class="col-lg-9">
              {% for format in page.formats %}
                <span class="badge badge-secondary badge-pill">{{format}}</span>
              {% endfor %}
            </dd>

            <dt class="col-lg-3">Files</dt>
            <dd class="col-lg-9">
              <code class="text-muted">{{ props.num_files | default: page.files }}</code>
            </dd>
          </dl>
        </div>
      </div>
    </div>
  </div>

  {% assign content = page.content | strip_newlines %}
  <div class="row mt-5">
    <!-- <div class="col-12"> -->
      {% if content == '' %}
      <div class="card w-100 text-center bg-secondary text-light">
        <div class="card-header">
          Read me
        </div>
        <div class="card-body">
          <h5 class="card-title">Contribute!</h5>
          <p>
            This dataset has no readme yet, describing how to download or use the dataset. <br/> 
            Are you familiar with this dataset? 
            Please consider <a class="text-dark" href="{{ site.baseurl }}/pages/contributing.html">contributing</a>.
          </p>
          <a href="{{ github_dataset_url }}" class="btn btn-light">Edit me on GitHub!</a>
        </div>
      </div>
      {% else %}
      <div class="card w-100">
        <div class="card-header">
          Readme
        </div>
        <div class="card-body">
          {{ content }}
        </div>
      </div>
      {% endif %}
    <!-- </div> -->
  </div>

  {% if has_analysis %}
  <div class="row mt-5">
    <div class="card w-100">
      <div class="card-header">
        Index
      </div>
      <div class="card-body">
        <table class="table table-hover border-top-0 table-sm small table-responsive-md">
          <thead>
            <tr>
              <th scope="col" class="border-top-0" width=5 class="text-muted">#</th>
              <th scope="col" class="border-top-0">ID</th>
              <th scope="col" class="border-top-0"></th>
              <th scope="col" class="border-top-0">Title</th>
              <th scope="col" class="border-top-0">Source</th>
              <th scope="col" class="border-top-0">Location</th>
              <th scope="col" class="border-top-0">Genre</th>
              <th scope="col" class="border-top-0" data-toggle="tooltip" title="Meter(s)">Mtr</th>
              <th scope="col" class="border-top-0" data-toggle="tooltip" title="Key">Key</th>
              <th scope="col" class="border-top-0" data-toggle="tooltip" title="Modality">Mod</th>
              <th scope="col" class="border-top-0" data-toggle="tooltip" title="Ambitus">Amb</th>
              <th scope="col" class="border-top-0">md5</th>
            </tr>
          </thead>
          <tbody>
            {% for file in index %}
            {% if forloop.index < max_num_files %}
            <tr>
              <td class="text-muted">{{ forloop.index }}</td>
              <th scope="row">{{ file.id }}</th>
              <td>
                {% if file.has_music == 'True' %}
                  <span class="badge badge-pill badge-dark" data-toggle="tooltip" title="Has music">
                    <span class="oi oi-musical-note"></span>
                  </span>
                {% else if file.has_music == 'False' %}
                  <span class="badge badge-pill badge-light" data-toggle="tooltip" title="Has no music">
                    <span class="oi oi-musical-note"></span>
                  </span>
                {% endif -%}

                {% if file.has_lyrics == 'True' %}
                  <span class="badge badge-pill badge-dark" data-toggle="tooltip" title="Has lyrics">
                    <span class="oi oi-text"></span>
                  </span>
                {% else if file.has_lyrics == 'False'%}
                  <span class="badge badge-pill badge-light" data-toggle="tooltip" title="Has no lyrics">
                    <span class="oi oi-text"></span>
                  </span>
                {% endif -%}

                {% if file.url %}
                  <a href="{{ file.url }}" target="_blank" class="badge badge-pill badge-light"
                    data-toggle="tooltip" title="View file">
                    <span class="oi oi-external-link" aria-hidden="true"></span></a>
                {% endif %}

                {% if file.preview_url %}
                  <a href="{{ file.preview_url }}" target="_blank" class="badge badge-pill badge-light"
                    data-toggle="tooltip" title="Online preview">
                    <span class="oi oi-magnifying-glass" aria-hidden="true"></span></a>
                {% endif %}

                {% if file.source_url %}
                  <a href="{{ file.source_url }}" target="_blank" class="badge badge-pill badge-light"
                    data-toggle="tooltip" title="View the original source">
                    <span class="oi oi-book" aria-hidden="true"></span></a>
                {% endif %}
              </td>
              <td>
                {%- if file.source_song_num %}
                  <span class="text-muted">{{ file.source_song_num }}. </span>
                {%- endif %}
                {%- if file.title %}
                  {%- assign title = file.title %}
                {%- else if file.title_eng %}
                  {%- assign title = file.title_eng %}
                {%- endif %}
                {%- assign title_len = title | size %}
                {%- if title_len > 30 %}
                  <span data-toggle="tooltip" title="{{file.title}}">{{ title | truncate: 30 }}</span>
                {%- else %}
                  {{ title }}
                {%- endif %}
              </td>
              <td>
                {%- capture citation %}{% cite file.source_key %}{% endcapture %}
                {%- if citation == '(missing reference)' %}
                  {{ file.source | truncate: 20 }}
                {%- else %}
                  {%- if file.source_page_num -%}
                    <span data-toggle="tooltip" title="p. {{file.source_page_num}}">
                  {%- endif %}
                  {{ citation }}
                  {%- if file.source_page_num %}</span>{% endif %}
                {%- endif %}
              </td>
              <td>
                {%- assign loc_len = file.location | size %}
                {%- if loc_len > 20 %}
                  <span data-toggle="tooltip" title="{{file.location}}">{{ file.location | truncate: 20 }}</span>
                {%- else %}
                  {{file.location}}
                {%- endif %}
              </td>
              <td data-toggle="tooltip" title="{{ file.genre }}">{{ file.genre | truncate: 10 }}</td>
              <td>
                {%- if file.meter -%}
                  {{ file.meter }}
                {%- else if file.metric_classification -%}
                  {{ file.metric_classification }}
                {%- endif -%}
              </td>
              <td>{{ file.key }}</td>
              <td>
                <span data-toggle="tooltip" title="{{file.modality}}">{{ file.modality | truncatewords: 1 }}</span>
              </td>
              <td>{{ file.ambitus }}</td>
              <td>
                <a class="small text-muted"
                  data-toggle="popover" data-html="true"
                  data-content="<code class='text-muted small'>{{ file.checksum }}</code>">
                  <code>{{ file.checksum | truncate: 5, "" }}</code>
                </a>
              </td>
            </tr>
            {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="card-footer text-center text-muted small">
        {% if max_num_files < props.num_files %}
          <span class="text-danger">Showing only the first {{ max_num_files }} of {{ props.num_files}} files. </span>
        {% endif %}
        You can <a href="{{ github_index_url }}" target="_blank">download the full index</a> as a csv file.
      </div>
    </div>
  </div>
  {% else %}
  <div class="row mt-5">
    <div class="card w-100 text-center bg-dark text-light">
      <div class="card-header">
        Index
      </div>
      <div class="card-body">
        <h5 class="card-title">Index not yet available</h5>
        <p>
          This dataset has not yet been analyzed...<br/> 
          Please consider <a class="text-light" href="{{ site.baseurl }}/pages/contributing.html">contributing</a>.
        </p>
      </div>
    </div>
  </div>  
  {% endif %}

  <div class="row mt-5">
    {%- capture num_cited_sources %}{% bibliography_count --cited %}{% endcapture %}
    {% if num_cited_sources != "0" and page.issues %}<div class="card-deck">{% endif %}
      {%- if num_cited_sources != "0" %}
      <div class="card w-100">
        <div class="card-header">Sources</div>
        <div class="card-body small">
          <div class="bibliography-not-numbered{% if num_cited_sources != '1' %} bibliography-col-2{%endif%}">
          {% bibliography --cited --sort_by author,year --order ascending %}
          </div>
        </div>
      </div>
      {%- endif %}
    
      {%- if page.issues %}
      <div class="card w-100 border-danger bg-light">
        <div class="card-header">Issues</div>
        <ul class="list-group list-group-flush small">
          {%- for issue in page.issues %}
          <li class="list-group-item bg-light">
            <p><strong>{{ issue.title }}</strong></p>
            {{ issue.description | markdownify }}
          </li>
          {%- endfor %}
        </ul>
      </div>
      {%- endif %}
    
    {%- if num_cited_sources != "0" and page.issues %}</div>{% endif %}
  </div>

  
</main>